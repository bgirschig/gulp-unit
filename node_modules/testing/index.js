// node unit testing
var colors = require('colors');

var Testing = {};
(function(){
	Testing = {
		currentTest:null,
		// result arrays
		passed:[],
		failed:[],
		// test list
		tests:{}
	}

	// Test handling functions
	Testing.addTest = function(name, testFunction){
		if(this.tests[name]!=null)
			console.log(("Test '"+name+"' is defined multiple times. last declaration will prevail").red);
		this.tests[name] = testFunction;
	}
	Testing.reset = function(){
		this.passed = [];
		this.failed = [];
		this.currentTest = null;
		this.tests = {};
	}

	// Testing functions
	Testing.equals = function(actual, expected){
		if(actual==expected) this.passed.push(this.currentTest);
		else this.failed.push(this.currentTest);
	}
	Testing.notEquals = function(actual, expected){
		if(actual!=expected) this.passed.push(this.currentTest);
		else this.failed.push(this.currentTest);
	}
	Testing.isTrue = function(value){
		if(value) this.passed.push(this.currentTest);
		else this.failed.push(this.currentTest);
	}
	Testing.isFalse = function(value){
		if(!value) this.passed.push(this.currentTest);
		else this.failed.push(this.currentTest);
	}

	Testing.run = function(name){
		// execute tests
		for(var testName in Testing.tests){
			Testing.currentTest = testName;
			Testing.tests[testName]();
		}
		logResults(name);
		Testing.reset();
	}
	function logResults(groupName){
		if (groupName == null) groupName = "Unit tests";
		console.log("\n"+groupName.bold);
		
		for (var i = 0; i < Testing.passed.length; i++){
			console.log(("√ Test passed: "+Testing.passed[i]).green);
		}
		for (var i = 0; i < Testing.failed.length; i++){
			console.log(("✖ Test failed: "+Testing.failed[i]).red);
		}
		// Test statistics
		var passedCount = Testing.passed.length;
		var failedCount = Testing.failed.length;
		if(failedCount==0){
			console.log("=> "+"all tests passed".green.bold);
		} else{
			console.log("=> "+(passedCount+" tests passed, "+(failedCount+" failed").red).bold);
		}
	}

	if(!isBrowser){
		module.exports = Testing;
	}
})();